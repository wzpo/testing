<template>
  <div class="chat_panel">
    <div class="chat_panel_wrap" :class="[theme]">
      <panel-header
        class="pheader"
        :title="title"
        :type="'chat'"
        :floating="chatPanelPopouted"
        :popoutVisible="true"
        @close="close"
        @popout="popout"
      ></panel-header>
      <div class="scrollpane" >
        <div class="list">
          <chat-item
            v-for="(p, index) in chatMsgList"
            :key="index"
            :type="p.type"
            :thread="p.thread"
            :time="p.time"
            :name="p.name"
            :isbot="p.isbot"
            :msg="p.msg"
            :attachment="p.attachment"
            :title="p.title"
            :file="p.file"
            :icon="p.icon"
            :click="p.click"
            :replies="p.replies"
          ></chat-item>
        </div>
      </div>
      <div class='inputbox' id="space-content-inputbox" >
        <input 
          v-model="message" 
          :placeholder="`Write a message`" 
          v-on:keyup.enter="sendmsg"
          class="chatinput"
        />

        <div class="tools" >
          <span class="icons">
            <svg width="128" height="16" viewBox="0 0 128 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1.49988 3H5.99942L5.99988 11.5C5.99988 11.6326 6.05256 11.7598 6.14632 11.8536C6.24009 11.9473 6.36727 12 6.49988 12C6.63249 12 6.75966 11.9473 6.85343 11.8536C6.9472 11.7598 6.99988 11.6326 6.99988 11.5L6.99942 3H11.4999C11.6325 3 11.7597 2.94732 11.8534 2.85355C11.9472 2.75979 11.9999 2.63261 11.9999 2.5C11.9999 2.36739 11.9472 2.24021 11.8534 2.14645C11.7597 2.05268 11.6325 2 11.4999 2H1.49988C1.36727 2 1.24009 2.05268 1.14632 2.14645C1.05256 2.24021 0.999878 2.36739 0.999878 2.5C0.999878 2.63261 1.05256 2.75979 1.14632 2.85355C1.24009 2.94732 1.36727 3 1.49988 3Z" fill="white" fill-opacity="0.7"/>
              <path d="M8.99988 5C8.86727 5 8.74009 5.05268 8.64633 5.14645C8.55256 5.24021 8.49988 5.36739 8.49988 5.5C8.49988 5.63261 8.55256 5.75979 8.64633 5.85355C8.74009 5.94732 8.86727 6 8.99988 6H11.4994V11.5C11.4994 11.6326 11.5521 11.7598 11.6458 11.8536C11.7396 11.9473 11.8668 12 11.9994 12C12.132 12 12.2592 11.9473 12.3529 11.8536C12.4467 11.7598 12.4994 11.6326 12.4994 11.5V6H14.4999C14.6325 6 14.7597 5.94732 14.8534 5.85355C14.9472 5.75979 14.9999 5.63261 14.9999 5.5C14.9999 5.36739 14.9472 5.24021 14.8534 5.14645C14.7597 5.05268 14.6325 5 14.4999 5H8.99988Z" fill="white" fill-opacity="0.7"/>
              <path d="M14.4999 13H1.49988C1.36727 13 1.24009 13.0527 1.14632 13.1464C1.05256 13.2402 0.999878 13.3674 0.999878 13.5C0.999878 13.6326 1.05256 13.7598 1.14632 13.8536C1.24009 13.9473 1.36727 14 1.49988 14H14.4999C14.6325 14 14.7597 13.9473 14.8534 13.8536C14.9472 13.7598 14.9999 13.6326 14.9999 13.5C14.9999 13.3674 14.9472 13.2402 14.8534 13.1464C14.7597 13.0527 14.6325 13 14.4999 13Z" fill="white" fill-opacity="0.7"/>
              <path d="M36 1C34.6155 1 33.2622 1.41054 32.111 2.17971C30.9599 2.94888 30.0627 4.04213 29.5328 5.32122C29.003 6.6003 28.8644 8.00776 29.1345 9.36563C29.4046 10.7235 30.0713 11.9708 31.0503 12.9497C32.0292 13.9287 33.2765 14.5954 34.6344 14.8655C35.9922 15.1356 37.3997 14.997 38.6788 14.4672C39.9579 13.9373 41.0511 13.0401 41.8203 11.889C42.5895 10.7378 43 9.38447 43 8C42.9979 6.14414 42.2597 4.36491 40.9474 3.05262C39.6351 1.74033 37.8559 1.00214 36 1ZM36 14C34.8133 14 33.6533 13.6481 32.6666 12.9888C31.6799 12.3295 30.9109 11.3925 30.4567 10.2961C30.0026 9.19974 29.8838 7.99334 30.1153 6.82946C30.3468 5.66557 30.9182 4.59647 31.7574 3.75736C32.5965 2.91824 33.6656 2.3468 34.8295 2.11529C35.9933 1.88378 37.1997 2.0026 38.2961 2.45672C39.3925 2.91085 40.3295 3.67988 40.9888 4.66658C41.6481 5.65327 42 6.81331 42 8C41.9982 9.59075 41.3655 11.1158 40.2407 12.2407C39.1158 13.3655 37.5908 13.9982 36 14Z" fill="white" fill-opacity="0.7"/>
              <path d="M33.75 7.5C34.1642 7.5 34.5 7.16421 34.5 6.75C34.5 6.33579 34.1642 6 33.75 6C33.3358 6 33 6.33579 33 6.75C33 7.16421 33.3358 7.5 33.75 7.5Z" fill="white" fill-opacity="0.7"/>
              <path d="M38.25 7.5C38.6642 7.5 39 7.16421 39 6.75C39 6.33579 38.6642 6 38.25 6C37.8358 6 37.5 6.33579 37.5 6.75C37.5 7.16421 37.8358 7.5 38.25 7.5Z" fill="white" fill-opacity="0.7"/>
              <path d="M39.1803 9.0339C39.0566 8.98641 38.9191 8.98986 38.7979 9.04349C38.6768 9.09712 38.5818 9.19656 38.5338 9.32005C38.3232 9.81851 37.9703 10.2438 37.5192 10.5426C37.0681 10.8415 36.5389 11.0007 35.9978 11.0002C35.4567 10.9997 34.9277 10.8396 34.4772 10.54C34.0266 10.2404 33.6744 9.81448 33.4647 9.31565C33.441 9.25381 33.4053 9.19729 33.3597 9.14936C33.314 9.10144 33.2593 9.06306 33.1986 9.03645C33.138 9.00985 33.0727 8.99555 33.0065 8.99438C32.9403 8.99322 32.8745 9.00521 32.813 9.02966C32.7515 9.05412 32.6954 9.09055 32.6481 9.13684C32.6008 9.18313 32.5631 9.23836 32.5373 9.29933C32.5115 9.3603 32.498 9.42578 32.4977 9.49199C32.4974 9.55819 32.5103 9.6238 32.5355 9.685C32.8194 10.3707 33.3004 10.9568 33.9175 11.3689C34.5347 11.7811 35.2603 12.0009 36.0024 12.0004C36.7446 11.9999 37.4699 11.7792 38.0865 11.3663C38.7032 10.9533 39.1834 10.3667 39.4664 9.6806C39.4901 9.61935 39.5015 9.55403 39.5 9.48837C39.4984 9.4227 39.484 9.35799 39.4574 9.29793C39.4308 9.23786 39.3927 9.18363 39.3451 9.13832C39.2976 9.09302 39.2415 9.05754 39.1803 9.0339Z" fill="white" fill-opacity="0.7"/>
              <path d="M67.5 1H60.5C59.8372 1.00078 59.2018 1.26442 58.7331 1.7331C58.2644 2.20177 58.0008 2.8372 58 3.5V12.5C58.0008 13.1628 58.2644 13.7982 58.7331 14.2669C59.2018 14.7356 59.8372 14.9992 60.5 15H67.5C68.1628 14.9992 68.7982 14.7356 69.2669 14.2669C69.7356 13.7982 69.9992 13.1628 70 12.5V3.5C69.9992 2.8372 69.7356 2.20177 69.2669 1.7331C68.7982 1.26442 68.1628 1.00078 67.5 1ZM69 12.5C68.9996 12.8977 68.8414 13.279 68.5602 13.5602C68.279 13.8414 67.8977 13.9996 67.5 14H60.5C60.1023 13.9996 59.721 13.8414 59.4398 13.5602C59.1586 13.279 59.0004 12.8977 59 12.5V3.5C59.0004 3.10231 59.1586 2.72103 59.4398 2.43982C59.721 2.15861 60.1023 2.00044 60.5 2H67.5C67.8977 2.00044 68.279 2.15861 68.5602 2.43982C68.8414 2.72103 68.9996 3.10231 69 3.5V12.5Z" fill="white" fill-opacity="0.7"/>
              <path d="M61.94 9.41C62.1009 9.39453 62.2619 9.43906 62.392 9.53503C62.5222 9.63101 62.6123 9.77167 62.645 9.93H63.48C63.4233 9.62282 63.2561 9.34702 63.01 9.1546C62.7015 8.92567 62.3239 8.80934 61.94 8.825C61.4993 8.80325 61.0668 8.94969 60.73 9.2347C60.5398 9.42266 60.3926 9.64962 60.2985 9.89993C60.2044 10.1502 60.1657 10.418 60.185 10.6847C60.1584 11.1743 60.3054 11.6576 60.6 12.0495C60.744 12.2221 60.9258 12.3593 61.1312 12.4504C61.3367 12.5415 61.5604 12.5841 61.785 12.5749C61.977 12.5865 62.1691 12.5558 62.3479 12.485C62.5267 12.4141 62.6878 12.3049 62.8196 12.1649L62.9396 12.4999H63.4796V10.495H61.905V11.04H62.755V11.295C62.7566 11.3835 62.7392 11.4713 62.7038 11.5524C62.6684 11.6335 62.6159 11.706 62.55 11.765C62.4686 11.8397 62.3732 11.8976 62.2694 11.9353C62.1656 11.9731 62.0554 11.9899 61.945 11.985C61.8322 11.989 61.72 11.9672 61.6169 11.9212C61.5138 11.8753 61.4225 11.8065 61.35 11.72C61.1333 11.4205 61.0305 11.0535 61.06 10.685C61.0395 10.3569 61.1159 10.03 61.2797 9.745C61.351 9.63641 61.4494 9.54836 61.5653 9.4896C61.6811 9.43083 61.8103 9.40339 61.94 9.41Z" fill="white" fill-opacity="0.7"/>
              <path d="M64.9347 8.8996H64.0948V12.4997H64.9347V8.8996Z" fill="white" fill-opacity="0.7"/>
              <path d="M65.5835 12.4995H66.4235V11.0445H67.7135V10.4645H66.4235V9.5045H67.8685V8.8995H65.5835V12.4995Z" fill="white" fill-opacity="0.7"/>
              <path d="M92 1C90.9123 0.999004 89.8394 1.25149 88.8662 1.73744C87.8931 2.22338 87.0466 2.92942 86.394 3.79952C85.7413 4.66962 85.3003 5.67986 85.1061 6.75008C84.9119 7.8203 84.9697 8.92106 85.2751 9.96502C85.5804 11.009 86.1248 11.9674 86.8651 12.7643C87.6054 13.5612 88.5213 14.1746 89.5399 14.5559C90.5586 14.9371 91.6522 15.0758 92.7338 14.9608C93.8154 14.8457 94.8553 14.4803 95.771 13.8933C95.8262 13.8577 95.8739 13.8116 95.9113 13.7576C95.9487 13.7036 95.975 13.6427 95.9889 13.5785C96.0028 13.5143 96.0039 13.448 95.9921 13.3834C95.9804 13.3188 95.956 13.2571 95.9204 13.2019C95.8848 13.1467 95.8387 13.099 95.7847 13.0617C95.7307 13.0243 95.6699 12.9979 95.6057 12.984C95.5415 12.9701 95.4752 12.969 95.4105 12.9808C95.3459 12.9925 95.2842 13.0169 95.229 13.0525C94.1064 13.7689 92.7774 14.0912 91.4513 13.9687C90.1253 13.8462 88.8777 13.2858 87.9054 12.376C86.933 11.4661 86.2912 10.2584 86.0811 8.94342C85.8709 7.62843 86.1044 6.2809 86.7448 5.11329C87.3852 3.94569 88.3959 3.02443 89.6178 2.49478C90.8396 1.96513 92.2029 1.85722 93.4929 2.18806C94.7828 2.51889 95.9259 3.26966 96.742 4.32199C97.5581 5.37431 98.0007 6.66832 98 8C98 10 97.1865 10 96.7495 10C96.4342 10.0098 96.1274 9.89643 95.8941 9.68393C95.6609 9.47142 95.5195 9.17647 95.5 8.86155V5C95.5 4.86739 95.4473 4.74022 95.3536 4.64645C95.2598 4.55268 95.1326 4.5 95 4.5C94.8674 4.5 94.7402 4.55268 94.6465 4.64645C94.5527 4.74022 94.5 4.86739 94.5 5V5.5568C93.997 5.04131 93.3472 4.69358 92.6392 4.56105C91.9313 4.42853 91.1996 4.51766 90.5442 4.81629C89.8888 5.11493 89.3415 5.60851 88.9769 6.2297C88.6124 6.85089 88.4484 7.56943 88.5073 8.28727C88.5662 9.00511 88.8452 9.68729 89.3061 10.2407C89.7671 10.7942 90.3875 11.1919 91.0829 11.3797C91.7782 11.5675 92.5146 11.5361 93.1915 11.2899C93.8683 11.0437 94.4528 10.5947 94.865 10.0041C95.0752 10.3101 95.3565 10.5606 95.6847 10.7341C96.013 10.9075 96.3784 10.9988 96.7496 11C98.2428 11 99 9.99095 99 8C98.9979 6.14415 98.2597 4.36491 96.9474 3.05262C95.6351 1.74033 93.8559 1.00215 92 1ZM91.9995 10.5008C91.5051 10.5008 91.0217 10.3541 90.6106 10.0794C90.1995 9.80472 89.879 9.41428 89.6898 8.95746C89.5006 8.50065 89.4511 7.99798 89.5476 7.51303C89.644 7.02807 89.8821 6.58262 90.2318 6.23299C90.5814 5.88335 91.0268 5.64525 91.5118 5.54879C91.9967 5.45233 92.4994 5.50183 92.9562 5.69105C93.413 5.88027 93.8035 6.2007 94.0782 6.61183C94.3529 7.02295 94.4995 7.5063 94.4995 8.00075C94.4987 8.66353 94.2351 9.29893 93.7664 9.76759C93.2978 10.2362 92.6623 10.4999 91.9995 10.5008Z" fill="white" fill-opacity="0.7"/>
              <path d="M124.968 4.49518L121.47 1.97859C121.044 1.66721 120.529 1.49929 120.001 1.49902C119.473 1.49876 118.959 1.66617 118.532 1.97712L115.03 4.49665C114.711 4.72894 114.452 5.03312 114.273 5.38445C114.094 5.73579 114.001 6.12438 114 6.51865V12.0001C114.001 12.6629 114.265 13.2983 114.733 13.767C115.202 14.2356 115.837 14.4993 116.5 14.5001H123.5C124.163 14.4993 124.798 14.2356 125.267 13.767C125.736 13.2983 125.999 12.6629 126 12.0001V6.51862C125.999 6.12396 125.906 5.73501 125.726 5.38341C125.547 5.03181 125.287 4.72749 124.968 4.49518ZM125 12.0001C125 12.3978 124.842 12.779 124.56 13.0602C124.279 13.3415 123.898 13.4996 123.5 13.5001H116.5C116.102 13.4996 115.721 13.3415 115.44 13.0602C115.159 12.779 115.001 12.3978 115 12.0001V6.51862C115 6.28246 115.056 6.04966 115.163 5.83911C115.27 5.62856 115.425 5.44616 115.616 5.30671L119.118 2.78718C119.374 2.60004 119.684 2.49932 120.001 2.49958C120.319 2.49984 120.628 2.60108 120.884 2.78865L124.382 5.30524C124.574 5.44471 124.729 5.62726 124.836 5.83808C124.944 6.0489 125 6.28206 125 6.51862V12.0001Z" fill="white" fill-opacity="0.7"/>
              <path d="M121.438 7.88389C121.711 7.60153 121.895 7.24511 121.967 6.85906C122.038 6.473 121.995 6.0744 121.841 5.71295C121.688 5.3515 121.432 5.04318 121.104 4.82644C120.777 4.6097 120.393 4.49413 120 4.49413C119.607 4.49413 119.224 4.6097 118.896 4.82644C118.569 5.04318 118.312 5.3515 118.159 5.71295C118.006 6.0744 117.962 6.473 118.034 6.85906C118.105 7.24511 118.289 7.60153 118.562 7.88389C118.104 8.12566 117.718 8.48438 117.444 8.92358C117.17 9.36277 117.016 9.86678 117 10.3843C117 10.7086 117.143 11.3087 118.097 11.6881C118.707 11.9081 119.352 12.0148 120 12.003C121.384 12.003 123 11.5792 123 10.3843C122.984 9.86678 122.831 9.36277 122.556 8.92357C122.282 8.48438 121.896 8.12566 121.438 7.88389ZM120 5.50007C120.198 5.50007 120.391 5.55872 120.556 5.6686C120.72 5.77848 120.848 5.93466 120.924 6.11739C121 6.30011 121.019 6.50118 120.981 6.69516C120.942 6.88914 120.847 7.06732 120.707 7.20718C120.567 7.34703 120.389 7.44227 120.195 7.48086C120.001 7.51944 119.8 7.49964 119.617 7.42395C119.435 7.34826 119.279 7.22009 119.169 7.05564C119.059 6.89119 119 6.69785 119 6.50007C119 6.23496 119.106 5.98081 119.293 5.79334C119.481 5.60588 119.735 5.50042 120 5.50007ZM120 11.003C118.779 11.003 118 10.6368 118 10.3843C118.032 9.87534 118.256 9.39751 118.628 9.04823C118.999 8.69895 119.49 8.5045 120 8.5045C120.51 8.5045 121.001 8.69895 121.373 9.04823C121.744 9.39751 121.969 9.87534 122 10.3843C122 10.6368 121.221 11.003 120 11.003Z" fill="white" fill-opacity="0.7"/>
            </svg>
          </span>
        </div>

        <div class="send" :class="{disabled: !message}">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14.725 7.55265L1.72502 1.05265C1.6373 1.0088 1.53862 0.991692 1.44126 1.00347C1.3439 1.01524 1.25214 1.05537 1.17741 1.11887C1.10267 1.18237 1.04824 1.26644 1.0209 1.36063C0.993559 1.45481 0.994503 1.55495 1.02362 1.6486L3.00112 8L1.02362 14.3515C0.994433 14.4451 0.993442 14.5453 1.02077 14.6395C1.04809 14.7337 1.10253 14.8178 1.17729 14.8813C1.25206 14.9448 1.34385 14.9849 1.44124 14.9966C1.53863 15.0083 1.63732 14.9912 1.72502 14.9472L14.725 8.4472C14.8081 8.40569 14.878 8.34185 14.9268 8.26285C14.9757 8.18385 15.0015 8.09281 15.0015 7.99993C15.0015 7.90705 14.9757 7.816 14.9268 7.737C14.878 7.658 14.8081 7.59417 14.725 7.55265ZM2.32732 2.4721L12.383 7.5H3.89267L2.32732 2.4721ZM3.89267 8.5H12.383L2.32732 13.5278L3.89267 8.5Z" fill="white" fill-opacity="0.4"/>
          </svg>
        </div>

      </div>
    </div>
  </div>
</template>

<script>
import popThisPanel from "./panel-chat.vue";
export default {
  props: {
    meetingId: String,
  },
  data() {
    return {
      title: "Meeting messages",
      message: "",
      panelName: 'popout-panel-chat',
    };
  },
  computed: {
    theme() {
      return this.$store.state.theme;
    },
    videoLayout() {
      return this.$store.getters.videoLayout(this.meetingId);
    },
    panelVisible() {
      return this.$store.state.panelVisible;
    },
    chatPanelVisible() {
      return this.$store.state.chatPanelVisible;
    },
    chatPanelPopouted() {
      return this.$store.state.chatPanelPopouted;
    },
    peopleList() {
      return this.$store.state.peopleList;
    },
    chatMsgList() {
      return this.$store.state.chatMsgList;
    },
    fullscreen() {
      return this.$store.state.fullscreen;
    }
  },
  mounted() {
  },
  watch: {
    chatPanelVisible(newVal) {
      if (!newVal && this.chatPanelPopouted) {
        this.$store.commit('chatPanelPopouted', false);
        this.$modal.hide(this.panelName);
      }
    }
  },
  methods: {
    close() {
      if (this.chatPanelPopouted) {
        this.$modal.hide(this.panelName);
      }
      this.$store.commit("chatPanelVisible", false);
      setTimeout( () => this.$store.commit("chatPanelPopouted", false), 100);
    },
    popout() {
      if (!this.chatPanelPopouted) {
        this.$modal.show(
          popThisPanel, 
          {
            
          }, // component props
          {
            name: this.panelName,
            clickToClose: false,
            frameless: false,
            shadow: true,
            resizable: true,
            draggable: '.pheader',
            overlayVisible: false,
            overlayTransparent: 0,
            theme: `${this.theme === 'light' ? 'light' : 'dark'} ${this.themeColor}`,
            roundedCorner: true,
            center: true,
            minWidth: 300,
            minHeight: 300,
            width: 360,
            height: 500,
            shiftX: 0.95,
            shiftY: 0.4,

          }, // modal props
          {
            closed: () => { },
          } // modal eventlistener
        );
      } else {
        this.$modal.hide(this.panelName);
      }
      this.$store.commit("chatPanelPopouted", !this.chatPanelPopouted);
    },
    sendmsg() {}
  }
};
</script>


<style lang="scss">
$paddingleft: 8px;

.chat_panel {
  width: 100%;
  height: 100%;
  font-size: 12px;
  pointer-events: auto;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  flex-shrink: 0;
  border-radius: 6px;
  transform: rotate(0deg);
  overflow: hidden;

}
  .chat_panel_wrap {
    display: flex;
    flex-direction: column;
    flex-grow: 1;

    .scrollpane {
      flex-shrink: 1;
      flex-grow: 1;
      width: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      height: 100px;
      scroll-behavior: smooth;
    }
    .list {
      width: 100%;
      padding-bottom: 10px;
    }
    .inputbox {
      position: relative;

      .tools {
        position: absolute;
        padding-left: $paddingleft;
        padding-right: 25px;
        padding-top: 10px;
        width: 100%;
        height: 40px;
        left: 0;
        top: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;

        .icons {
          display: flex;
          align-items: center;

          path {
            fill: white;
            fill-opacity: 0.7;
          }
          .stroke {
            stroke: rgba($color: #FFFFFF, $alpha: .7);
          }

          .ico {
            margin-right: 20px;
          }
        }

        .warning {
          path {
            fill: $md-yellow-40;
          }
        }

      }

      .send {
        position: absolute;
        @include flex;
        width: 16px;
        height: 16px;
        top: 40px;
        right: 24px;

        svg path {
          fill: $md-blue-40;
          fill-opacity: 1.0;
        }
        
        &.disabled {
          opacity: .4;

          svg path {
            fill: white;
          }
        }

      }

      .chatinput {
        border: none;
        width: 100%;
        font-size: 16px;
        padding: 34px 15px 10px $paddingleft;
        margin-left: 4px;
        border-top: 1px solid transparent;
        background: transparent;
        cursor: text;
        color: rgba($color: white, $alpha: 0.95);
        ::placeholder {
          color: rgba($color: white, $alpha: 0.7) !important;
        }

      }
      .chatinput:focus {
        outline: none;
        box-shadow: none;
        border-top: 1px solid rgba($color: $md-blue-40, $alpha: 0.0);
      }
    }


    /* theme ----- dark/hybrid */
    &.hybrid {
      color: $text-color-primary-light-ui;
    }
    &.dark {
      color: $text-color-primary-dark-ui;
    }

  }
  
</style>
